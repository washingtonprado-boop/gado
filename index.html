<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Animais Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* CSS Unificado */
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; min-height: 100vh;}
        .app-container {background: #f8fafc; min-height: 100vh;}
        .header {background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative;}
        .header h1 {font-size: 2rem; margin-bottom: 0.5rem;}
        .sync-status {position: absolute; top: 2rem; right: 2rem; background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 2rem; font-size: 0.875rem;}
        .nav-tabs {background: white; border-bottom: 2px solid #e2e8f0; padding: 0 2rem; display: flex; gap: 0.5rem; overflow-x: auto; sticky; top: 0; z-index: 100;}
        .nav-tab {padding: 1.2rem 1.5rem; border: none; background: none; cursor: pointer; font-size: 0.9rem; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; transition: 0.3s; white-space: nowrap;}
        .nav-tab:hover {color: #3b82f6;}
        .nav-tab.active {color: #3b82f6; border-bottom-color: #3b82f6;}
        .container {max-width: 1600px; margin: 0 auto; padding: 2rem;}
        .main-grid {display: grid; grid-template-columns: 400px 1fr; gap: 2rem;}
        .card {background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 2rem;}
        .form-group {margin-bottom: 1rem;}
        .form-group label {display: block; font-size: 0.75rem; font-weight: 700; color: #475569; text-transform: uppercase; margin-bottom: 0.4rem;}
        .form-group input, .form-group select, .form-group textarea {width: 100%; padding: 0.6rem 0.8rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 0.9rem;}
        .btn {padding: 0.7rem 1.2rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;}
        .btn-primary {background: #3b82f6; color: white;}
        .btn-success {background: #22c55e; color: white;}
        .btn-danger {background: #ef4444; color: white;}
        .btn-warning {background: #f59e0b; color: white;}
        .btn-secondary {background: #64748b; color: white;}
        .grid-2 {display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;}
        .checkbox-group {display: flex; gap: 1rem; margin: 1rem 0; padding: 1rem; background: #f8fafc; border-radius: 0.5rem;}
        table {width: 100%; border-collapse: collapse;}
        th {background: #f8fafc; padding: 1rem; text-align: left; font-size: 0.75rem; color: #64748b; border-bottom: 2px solid #e2e8f0;}
        td {padding: 1rem; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem;}
        tr:hover {background: #f1f5f9; cursor: pointer;}
        .hidden {display: none;}
        .stats-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;}
        .stat-card {background: white; padding: 1.5rem; border-radius: 1rem; text-align: center; border-bottom: 4px solid #3b82f6;}
        .chart-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;}
        .item-box {display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; background: #f8fafc; border-radius: 0.5rem; margin-bottom: 0.5rem; border: 1px solid #e2e8f0;}
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üêÑ SisGado Pro</h1>
            <p>Gest√£o Pecu√°ria Inteligente 2026</p>
            <div class="sync-status">
                <span id="syncStatus">Dados Locais (Offline)</span>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('animals')">üêÆ Rebanho</button>
            <button class="nav-tab" onclick="showTab('reprodutores')">üêÇ Reprodutores</button>
            <button class="nav-tab" onclick="showTab('reports')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('genealogy')">üå≥ Genealogia</button>
            <button class="nav-tab" onclick="showTab('racas')">üè∑Ô∏è Ra√ßas</button>
            <button class="nav-tab" onclick="showTab('locais')">üìç Pastos</button>
            <button class="nav-tab" onclick="showTab('owners')">üë• Propriet√°rios</button>
            <button class="nav-tab" onclick="showTab('tools')">üßÆ Calculadoras</button>
        </div>

        <div class="container">
            <div id="tab-animals" class="tab-content">
                <div class="main-grid">
                    <div class="card">
                        <h2>Ficha do Animal</h2>
                        <form id="animalForm" onsubmit="salvarAnimal(event)">
                            <div class="form-group">
                                <label>N√∫mero/ID</label>
                                <div style="display:flex; gap:5px">
                                    <input type="text" id="numero" required>
                                    <button type="button" class="btn btn-secondary" onclick="gerarNumero()">Aut</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Brinco</label>
                                <input type="text" id="brinco">
                            </div>
                            <div class="form-group">
                                <label>Nome</label>
                                <input type="text" id="nome">
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label>Sexo</label>
                                    <select id="sexo">
                                        <option value="M">Macho</option>
                                        <option value="F">F√™mea</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ra√ßa</label>
                                    <select id="raca"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Local/Pasto</label>
                                <select id="local"></select>
                            </div>
                            <div class="form-group">
                                <label>Propriet√°rio</label>
                                <select id="proprietario"></select>
                            </div>
                            <div class="form-group">
                                <label>Nascimento</label>
                                <input type="date" id="dataNascimento">
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label>Pai (Touro)</label>
                                    <select id="pai"></select>
                                </div>
                                <div class="form-group">
                                    <label>M√£e (Matriz)</label>
                                    <select id="mae"></select>
                                </div>
                            </div>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="semFerro"> Sem Ferro</label>
                                <label><input type="checkbox" id="amamentando"> Amamentando</label>
                            </div>
                            <div class="btn-group" style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button type="submit" class="btn btn-primary">Salvar</button>
                                <button type="button" class="btn btn-warning" onclick="limparForm()">Limpar</button>
                                <button type="button" class="btn btn-danger" onclick="excluirAnimal()" style="grid-column: span 2;">Excluir</button>
                            </div>
                        </form>
                    </div>

                    <div class="card">
                        <div style="display:flex; justify-content: space-between; margin-bottom: 1rem;">
                            <input type="text" placeholder="Pesquisar..." style="padding:0.5rem; width: 60%;" onkeyup="pesquisarAnimais(this.value)">
                            <div style="display:flex; gap:5px;">
                                <button class="btn btn-success" onclick="exportarExcel()">Excel</button>
                                <button class="btn btn-danger" onclick="exportarPDF()">PDF</button>
                            </div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table>
                                <thead>
                                    <tr><th>ID</th><th>Brinco</th><th>Nome</th><th>Sexo</th><th>Ra√ßa</th><th>Local</th></tr>
                                </thead>
                                <tbody id="tabelaAnimais"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-reprodutores" class="tab-content hidden">
                <div class="card">
                    <h2>Cadastrar Touro/S√™men Externo</h2>
                    <div class="grid-2">
                        <div class="form-group"><label>Nome</label><input type="text" id="nomeReprodutor"></div>
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="tipoReprodutor">
                                <option value="Touro">Touro Vivo</option>
                                <option value="S√™men">S√™men</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="salvarReprodutor()">Adicionar Reprodutor</button>
                    <div id="listaReprodutores" style="margin-top: 1rem;"></div>
                </div>
            </div>

            <div id="tab-reports" class="tab-content hidden">
                <div class="stats-grid">
                    <div class="stat-card"><h3>Total</h3><div id="totalAnimais" style="font-size: 2rem; font-weight: bold;">0</div></div>
                    <div class="stat-card"><h3>F√™meas</h3><div id="totalFemeas" style="font-size: 2rem; font-weight: bold; color: #ec4899;">0</div></div>
                    <div class="stat-card"><h3>Machos</h3><div id="totalMachos" style="font-size: 2rem; font-weight: bold; color: #3b82f6;">0</div></div>
                </div>
                <div class="chart-grid">
                    <div class="card"><canvas id="racaChart"></canvas></div>
                    <div class="card"><canvas id="localChart"></canvas></div>
                </div>
            </div>

            <div id="tab-genealogy" class="tab-content hidden">
                <div class="card">
                    <h2>√Årvore Geneal√≥gica</h2>
                    <select id="animalGenealogia" onchange="mostrarGenealogia()" style="padding:1rem; width:100%; margin-bottom: 1rem;"></select>
                    <div id="arvoreGenealogia" style="padding: 2rem; background: #f8fafc; border-radius: 1rem; border: 2px dashed #cbd5e1;"></div>
                </div>
            </div>

            <div id="tab-racas" class="tab-content hidden">
                <div class="card">
                    <h2>Gerenciar Ra√ßas</h2>
                    <div class="form-group"><input type="text" id="novaRaca" placeholder="Nome da Ra√ßa"></div>
                    <button class="btn btn-primary" onclick="adicionarConfig('racas', 'novaRaca')">Adicionar</button>
                    <div id="listaRacas" style="margin-top: 1rem;"></div>
                </div>
            </div>

            <div id="tab-locais" class="tab-content hidden">
                <div class="card">
                    <h2>Gerenciar Pastos/Locais</h2>
                    <div class="form-group"><input type="text" id="novoLocal" placeholder="Nome do Pasto"></div>
                    <button class="btn btn-primary" onclick="adicionarConfig('locais', 'novoLocal')">Adicionar</button>
                    <div id="listaLocais" style="margin-top: 1rem;"></div>
                </div>
            </div>

            <div id="tab-owners" class="tab-content hidden">
                <div class="card">
                    <h2>Gerenciar Propriet√°rios</h2>
                    <div class="form-group"><input type="text" id="novoProp" placeholder="Nome do Propriet√°rio"></div>
                    <button class="btn btn-primary" onclick="adicionarConfig('proprietarios', 'novoProp')">Adicionar</button>
                    <div id="listaProprietarios" style="margin-top: 1rem;"></div>
                </div>
            </div>

            <div id="tab-tools" class="tab-content hidden">
                <div class="grid-2">
                    <div class="card">
                        <h3>C√°lculo de Arrobas</h3>
                        <div class="form-group"><label>Peso Vivo (kg)</label><input type="number" id="pesoV" oninput="calcArr()"></div>
                        <p id="resArr" style="font-weight: bold; color: #3b82f6;"></p>
                    </div>
                    <div class="card">
                        <h3>Previs√£o de Parto</h3>
                        <div class="form-group"><label>Data Insemina√ß√£o</label><input type="date" id="dataIns" onchange="calcParto()"></div>
                        <p id="resParto" style="font-weight: bold; color: #ec4899;"></p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // ESTADO GLOBAL
        let animais = JSON.parse(localStorage.getItem('gado_animais')) || [];
        let reprodutores = JSON.parse(localStorage.getItem('gado_reprod')) || [];
        let racas = JSON.parse(localStorage.getItem('gado_racas')) || ['NELORE', 'ANGUS', 'BRAHMAN'];
        let locais = JSON.parse(localStorage.getItem('gado_locais')) || ['PASTO 01', 'CURRAL'];
        let proprietarios = JSON.parse(localStorage.getItem('gado_props')) || ['FAZENDA PROPRIA'];
        let animalAtualId = null;
        let charts = {};

        // INICIALIZA√á√ÉO
        window.onload = () => {
            renderizarTabela();
            atualizarSelects();
            renderListasSimples();
        };

        // NAVEGA√á√ÉO
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            if(tabName === 'reports') atualizarDashboard();
        }

        // CRUD ANIMAIS
        function salvarAnimal(e) {
            e.preventDefault();
            const animal = {
                id: animalAtualId || Date.now().toString(),
                numero: document.getElementById('numero').value,
                brinco: document.getElementById('brinco').value,
                nome: document.getElementById('nome').value,
                sexo: document.getElementById('sexo').value,
                raca: document.getElementById('raca').value,
                local: document.getElementById('local').value,
                proprietario: document.getElementById('proprietario').value,
                dataNascimento: document.getElementById('dataNascimento').value,
                pai: document.getElementById('pai').value,
                mae: document.getElementById('mae').value,
                semFerro: document.getElementById('semFerro').checked,
                amamentando: document.getElementById('amamentando').checked
            };

            if (animalAtualId) {
                const idx = animais.findIndex(a => a.id === animalAtualId);
                animais[idx] = animal;
            } else {
                animais.push(animal);
            }

            localStorage.setItem('gado_animais', JSON.stringify(animais));
            renderizarTabela();
            atualizarSelects();
            limparForm();
            alert("Sucesso!");
        }

        function excluirAnimal() {
            if(!animalAtualId) return;
            if(confirm("Deseja excluir?")) {
                animais = animais.filter(a => a.id !== animalAtualId);
                localStorage.setItem('gado_animais', JSON.stringify(animais));
                renderizarTabela();
                limparForm();
            }
        }

        function selecionarAnimal(id) {
            const a = animais.find(x => x.id === id);
            animalAtualId = id;
            document.getElementById('numero').value = a.numero;
            document.getElementById('brinco').value = a.brinco;
            document.getElementById('nome').value = a.nome;
            document.getElementById('sexo').value = a.sexo;
            document.getElementById('raca').value = a.raca;
            document.getElementById('local').value = a.local;
            document.getElementById('proprietario').value = a.proprietario;
            document.getElementById('dataNascimento').value = a.dataNascimento;
            document.getElementById('pai').value = a.pai;
            document.getElementById('mae').value = a.mae;
            document.getElementById('semFerro').checked = a.semFerro;
            document.getElementById('amamentando').checked = a.amamentando;
        }

        function limparForm() {
            animalAtualId = null;
            document.getElementById('animalForm').reset();
        }

        // TABELA E RENDERIZA√á√ÉO
        function renderizarTabela(data = animais) {
            const tbody = document.getElementById('tabelaAnimais');
            tbody.innerHTML = data.map(a => `
                <tr onclick="selecionarAnimal('${a.id}')">
                    <td>${a.numero}</td>
                    <td>${a.brinco || '-'}</td>
                    <td>${a.nome || '-'}</td>
                    <td>${a.sexo}</td>
                    <td>${a.raca}</td>
                    <td>${a.local}</td>
                </tr>
            `).join('');
        }

        function pesquisarAnimais(val) {
            const filtrados = animais.filter(a => 
                a.numero.includes(val) || 
                (a.nome && a.nome.toLowerCase().includes(val.toLowerCase()))
            );
            renderizarTabela(filtrados);
        }

        // SELECTS DIN√ÇMICOS
        function atualizarSelects() {
            const fill = (id, list) => {
                const el = document.getElementById(id);
                if(!el) return;
                el.innerHTML = list.map(i => `<option value="${i}">${i}</option>`).join('');
            };

            fill('raca', racas);
            fill('local', locais);
            fill('proprietario', proprietarios);
            
            // Pais e M√£es
            const paisExternos = reprodutores.map(r => r.nome);
            const paisInternos = animais.filter(a => a.sexo === 'M').map(a => a.numero);
            const maes = animais.filter(a => a.sexo === 'F').map(a => a.numero);

            document.getElementById('pai').innerHTML = '<option value="">Corte/Desconhecido</option>' + [...paisExternos, ...paisInternos].map(p => `<option value="${p}">${p}</option>`).join('');
            document.getElementById('mae').innerHTML = '<option value="">Desconhecida</option>' + maes.map(m => `<option value="${m}">${m}</option>`).join('');
            
            // Select Genealogia
            document.getElementById('animalGenealogia').innerHTML = '<option value="">Selecione um animal...</option>' + animais.map(a => `<option value="${a.id}">${a.numero} ${a.nome || ''}</option>`).join('');
        }

        // CONFIGURA√á√ïES SIMPLES
        function adicionarConfig(tipo, inputId) {
            const val = document.getElementById(inputId).value.toUpperCase();
            if(!val) return;
            if(tipo === 'racas') { racas.push(val); localStorage.setItem('gado_racas', JSON.stringify(racas)); }
            if(tipo === 'locais') { locais.push(val); localStorage.setItem('gado_locais', JSON.stringify(locais)); }
            if(tipo === 'proprietarios') { proprietarios.push(val); localStorage.setItem('gado_props', JSON.stringify(proprietarios)); }
            document.getElementById(inputId).value = '';
            atualizarSelects();
            renderListasSimples();
        }

        function renderListasSimples() {
            const render = (id, list) => {
                document.getElementById(id).innerHTML = list.map(item => `<div class="item-box">${item}</div>`).join('');
            };
            render('listaRacas', racas);
            render('listaLocais', locais);
            render('listaProprietarios', proprietarios);
            
            document.getElementById('listaReprodutores').innerHTML = reprodutores.map(r => `
                <div class="item-box">
                    <span>${r.nome} (${r.tipo})</span>
                    <button class="btn btn-danger" onclick="removerReprod('${r.id}')">X</button>
                </div>
            `).join('');
        }

        function salvarReprodutor() {
            const nome = document.getElementById('nomeReprodutor').value.toUpperCase();
            const tipo = document.getElementById('tipoReprodutor').value;
            if(!nome) return;
            reprodutores.push({id: Date.now().toString(), nome, tipo});
            localStorage.setItem('gado_reprod', JSON.stringify(reprodutores));
            document.getElementById('nomeReprodutor').value = '';
            renderListasSimples();
            atualizarSelects();
        }

        // DASHBOARD
        function atualizarDashboard() {
            document.getElementById('totalAnimais').innerText = animais.length;
            document.getElementById('totalFemeas').innerText = animais.filter(a => a.sexo === 'F').length;
            document.getElementById('totalMachos').innerText = animais.filter(a => a.sexo === 'M').length;

            renderChart('racaChart', 'Distribui√ß√£o por Ra√ßa', animais.map(a => a.raca));
            renderChart('localChart', 'Distribui√ß√£o por Pasto', animais.map(a => a.local));
        }

        function renderChart(canvasId, label, rawData) {
            if(charts[canvasId]) charts[canvasId].destroy();
            const counts = rawData.reduce((acc, val) => { acc[val] = (acc[val] || 0) + 1; return acc; }, {});
            
            charts[canvasId] = new Chart(document.getElementById(canvasId), {
                type: 'pie',
                data: {
                    labels: Object.keys(counts),
                    datasets: [{
                        data: Object.values(counts),
                        backgroundColor: ['#3b82f6', '#ec4899', '#f59e0b', '#22c55e', '#64748b']
                    }]
                },
                options: { plugins: { title: { display: true, text: label } } }
            });
        }

        // GENEALOGIA
        function mostrarGenealogia() {
            const id = document.getElementById('animalGenealogia').value;
            const a = animais.find(x => x.id === id);
            const box = document.getElementById('arvoreGenealogia');
            if(!a) { box.innerHTML = "Selecione um animal para ver a √°rvore"; return; }

            box.innerHTML = `
                <div style="text-align: center;">
                    <div style="background: white; padding: 10px; border: 2px solid #3b82f6; display: inline-block; border-radius: 8px;">
                        <strong>${a.numero}</strong><br><small>${a.nome || ''}</small>
                    </div>
                    <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="padding: 10px; background: #e0f2fe; border-radius: 8px;">
                            <strong>PAI:</strong><br>${a.pai || '---'}
                        </div>
                        <div style="padding: 10px; background: #fce7f3; border-radius: 8px;">
                            <strong>M√ÉE:</strong><br>${a.mae || '---'}
                        </div>
                    </div>
                </div>
            `;
        }

        // CALCULADORAS
        function calcArr() {
            const kg = document.getElementById('pesoV').value;
            if(kg) {
                const arr = (kg * 0.50) / 15;
                document.getElementById('resArr').innerText = `Rendimento Estimado: ${arr.toFixed(2)} @`;
            }
        }

        function calcParto() {
            const d = document.getElementById('dataIns').value;
            if(d) {
                let p = new Date(d);
                p.setDate(p.getDate() + 284);
                document.getElementById('resParto').innerText = `Parto Previsto: ${p.toLocaleDateString('pt-BR')}`;
            }
        }

        // EXPORTA√á√ÉO
        function exportarExcel() {
            const ws = XLSX.utils.json_to_sheet(animais);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Rebanho");
            XLSX.writeFile(wb, "Rebanho_Completo.xlsx");
        }

        function exportarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("Relat√≥rio de Rebanho", 10, 10);
            let y = 20;
            animais.forEach(a => {
                doc.text(`${a.numero} | ${a.nome || '-'} | ${a.raca} | ${a.local}`, 10, y);
                y += 10;
            });
            doc.save("Relatorio.pdf");
        }

        function gerarNumero() {
            const max = animais.length > 0 ? Math.max(...animais.map(a => parseInt(a.numero) || 0)) : 0;
            document.getElementById('numero').value = max + 1;
        }
    </script>
</body>
</html>
