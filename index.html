
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Animais</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;}
        .app-container {background: #f8fafc; min-height: 100vh;}
        .header {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative;}
        .header h1 {font-size: 2rem; margin-bottom: 0.5rem;}
        .header p {opacity: 0.9;}
        .sync-status {position: absolute; top: 2rem; right: 2rem; background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 2rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.5rem; cursor: pointer;}
        .sync-indicator {width: 8px; height: 8px; border-radius: 50%; background: #22c55e; animation: pulse 2s infinite;}
        @keyframes pulse {0%, 100% {opacity: 1;} 50% {opacity: 0.5;}}
        .nav-tabs {background: white; border-bottom: 2px solid #e2e8f0; padding: 0 2rem; display: flex; gap: 1rem; overflow-x: auto;}
        .nav-tab {padding: 1rem 1.5rem; border: none; background: none; cursor: pointer; font-size: 0.95rem; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; transition: all 0.3s;}
        .nav-tab:hover {color: #667eea; background: #f8fafc;}
        .nav-tab.active {color: #667eea; border-bottom-color: #667eea;}
        .container {max-width: 1600px; margin: 0 auto; padding: 2rem;}
        .main-grid {display: grid; grid-template-columns: 420px 1fr; gap: 2rem;}
        .card {background: white; border-radius: 1rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding: 2rem;}
        .card h2 {font-size: 1.25rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f1f5f9;}
        .form-group {margin-bottom: 1.25rem;}
        .form-group label {display: block; font-size: 0.875rem; font-weight: 600; color: #475569; margin-bottom: 0.5rem;}
        .form-group input, .form-group select, .form-group textarea {width: 100%; padding: 0.75rem 1rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; font-size: 0.875rem; background: #f8fafc;}
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {outline: none; border-color: #667eea; background: white;}
        .input-group {display: flex; gap: 0.5rem;}
        .input-group input {flex: 1;}
        .btn {padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s;}
        .btn-primary {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;}
        .btn-primary:hover {transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);}
        .btn-secondary {background: #e2e8f0; color: #334155;}
        .btn-danger {background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;}
        .btn-success {background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white;}
        .btn-warning {background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;}
        .btn-group {display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-top: 2rem;}
        .grid-2 {display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;}
        .checkbox-group {display: flex; flex-wrap: wrap; gap: 1.5rem; margin: 1rem 0; padding: 1rem; background: #f8fafc; border-radius: 0.5rem;}
        .checkbox-label {display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; font-weight: 500; cursor: pointer;}
        .search-box {padding: 1.5rem; border-bottom: 2px solid #f1f5f9;}
        .search-input {width: 100%; padding: 0.875rem 1.25rem; border: 2px solid #e2e8f0; border-radius: 0.75rem; font-size: 0.875rem; background: #f8fafc;}
        .table-actions {padding: 1.5rem; display: flex; gap: 0.75rem; border-bottom: 2px solid #f1f5f9; flex-wrap: wrap;}
        table {width: 100%; border-collapse: collapse;}
        thead {background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);}
        th {padding: 1rem 1.25rem; text-align: left; font-size: 0.75rem; font-weight: 700; color: #475569; text-transform: uppercase;}
        td {padding: 1rem 1.25rem; font-size: 0.875rem; border-bottom: 1px solid #f1f5f9;}
        tbody tr {cursor: pointer; transition: background 0.2s;}
        tbody tr:hover {background: #f8fafc;}
        tbody tr.selected {background: #ede9fe;}
        .empty-state {padding: 4rem 2rem; text-align: center; color: #94a3b8;}
        .stats-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;}
        .stat-card {background: white; border-radius: 1rem; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); text-align: center; border-top: 4px solid;}
        .stat-card.blue {border-top-color: #3b82f6;} .stat-card.green {border-top-color: #22c55e;} .stat-card.red {border-top-color: #ef4444;} .stat-card.purple {border-top-color: #a855f7;} .stat-card.yellow {border-top-color: #f59e0b;} .stat-card.pink {border-top-color: #ec4899;}
        .stat-value {font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;}
        .stat-label {font-size: 0.875rem; color: #64748b; font-weight: 600;}
        .stat-value.blue {color: #3b82f6;} .stat-value.green {color: #22c55e;} .stat-value.red {color: #ef4444;} .stat-value.purple {color: #a855f7;} .stat-value.yellow {color: #f59e0b;} .stat-value.pink {color: #ec4899;}
        .chart-container {background: white; border-radius: 1rem; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 2rem;}
        .chart-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 2rem;}
        .item-list {margin-top: 1.5rem;}
        .item-box {padding: 1rem; background: #f8fafc; margin-top: 0.75rem; border-radius: 0.75rem; display: flex; justify-content: space-between; align-items: center; border: 2px solid #e2e8f0;}
        .genealogy-tree {padding: 2rem; background: #f8fafc; border-radius: 1rem; margin-top: 1.5rem; border: 2px solid #e2e8f0;}
        .tree-node {background: white; padding: 1rem; border-radius: 0.75rem; margin: 0.5rem 0; border: 2px solid #e2e8f0;}
        .tree-branch {margin-left: 2rem; border-left: 2px solid #cbd5e1; padding-left: 1rem;}
        .modal {display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);}
        .modal.active {display: flex; align-items: center; justify-content: center;}
        .modal-content {background: white; padding: 2rem; border-radius: 1rem; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;}
        .hidden {display: none;}
        @media (max-width: 1024px) {.main-grid, .chart-grid {grid-template-columns: 1fr;} .sync-status {position: relative; top: auto; right: auto; margin-top: 1rem;}}
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üêÑ Sistema de Controle de Animais</h1>
            <p>Gest√£o completa do seu rebanho</p>
            <div class="sync-status" onclick="abrirModalFirebase()">
                <div class="sync-indicator"></div>
                <span id="syncStatus">Clique para configurar Firebase</span>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('animals')">üêÆ Animais</button>
            <button class="nav-tab" onclick="showTab('reports')">üìä Relat√≥rios</button>
            <button class="nav-tab" onclick="showTab('genealogy')">üå≥ Genealogia</button>
            <button class="nav-tab" onclick="showTab('racas')">üè∑Ô∏è Ra√ßas</button>
            <button class="nav-tab" onclick="showTab('locais')">üìç Locais</button>
            <button class="nav-tab" onclick="showTab('tools')">üßÆ Ferramentas</button>
            <button class="nav-tab" onclick="showTab('owners')">üë• Propriet√°rios</button>
        </div>

        <div class="container">
            <div id="tab-animals" class="tab-content">
                <div class="main-grid">
                    <div class="card">
                        <h2>üìù Dados do Animal</h2>
                        <form id="animalForm" onsubmit="salvarAnimal(event)">
                            <div class="form-group">
                                <label>N√öMERO *</label>
                                <div class="input-group">
                                    <input type="text" id="numero" required>
                                    <button type="button" class="btn btn-primary" onclick="gerarNumero()">Gerar</button>
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="usaBrinco" onchange="toggleBrinco()">
                                    Usar Brinco
                                </label>
                            </div>

                            <div class="form-group hidden" id="campoBrinco">
                                <label>Brinco</label>
                                <input type="text" id="brinco">
                            </div>

                            <div class="form-group">
                                <label>Nome</label>
                                <input type="text" id="nome">
                            </div>

                            <div class="grid-2">
                                <div class="form-group">
                                    <label>Sexo</label>
                                    <select id="sexo">
                                        <option value="M">Macho</option>
                                        <option value="F">F√™mea</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ra√ßa</label>
                                    <select id="raca"></select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Local/Pasto</label>
                                <select id="local"></select>
                            </div>

                            <div class="form-group">
                                <label>Propriet√°rio</label>
                                <select id="proprietario"></select>
                            </div>

                            <div class="form-group">
                                <label>Data de Nascimento</label>
                                <input type="date" id="dataNascimento">
                            </div>

                            <div class="grid-2">
                                <div class="form-group">
                                    <label>Pai</label>
                                    <select id="pai"></select>
                                </div>
                                <div class="form-group">
                                    <label>M√£e</label>
                                    <select id="mae"></select>
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="semFerro">
                                    Sem Ferro
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="amamentando">
                                    Amamentando
                                </label>
                            </div>

                            <div class="form-group">
                                <label>Observa√ß√µes</label>
                                <textarea id="observacoes" rows="3"></textarea>
                            </div>

                            <div class="btn-group">
                                <button type="button" class="btn btn-secondary" onclick="limparForm()">üÜï Novo</button>
                                <button type="submit" class="btn btn-primary">üíæ Salvar</button>
                                <button type="button" class="btn btn-danger" onclick="excluirAnimal()">üóëÔ∏è Excluir</button>
                            </div>
                        </form>
                    </div>

                    <div class="card">
                        <div class="search-box">
                            <input type="text" class="search-input" placeholder="üîç Pesquisar..." onkeyup="pesquisarAnimais(this.value)">
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-success" onclick="exportarExcel()">üì• Excel</button>
                            <button class="btn btn-danger" onclick="exportarPDF()">üìÑ PDF</button>
                            <button class="btn btn-warning" onclick="sincronizar()">üîÑ Sincronizar</button>
                        </div>
                        <table>
                            <thead>
                                <tr><th>N√öMERO</th><th>Brinco</th><th>Nome</th><th>Sexo</th><th>Ra√ßa</th><th>Local</th></tr>
                            </thead>
                            <tbody id="tabelaAnimais">
                                <tr><td colspan="6" class="empty-state">Nenhum animal cadastrado</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tab-reports" class="tab-content hidden">
                <h2 style="margin-bottom: 2rem;">üìä Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card blue"><div class="stat-value blue" id="totalAnimais">0</div><div class="stat-label">Total</div></div>
                    <div class="stat-card green"><div class="stat-value green" id="totalFemeas">0</div><div class="stat-label">F√™meas</div></div>
                    <div class="stat-card purple"><div class="stat-value purple" id="totalMachos">0</div><div class="stat-label">Machos</div></div>
                    <div class="stat-card yellow"><div class="stat-value yellow" id="totalAmamentando">0</div><div class="stat-label">Amamentando</div></div>
                    <div class="stat-card red"><div class="stat-value red" id="totalSemFerro">0</div><div class="stat-label">Sem Ferro</div></div>
                    <div class="stat-card pink"><div class="stat-value pink" id="totalRacas">0</div><div class="stat-label">Ra√ßas</div></div>
                </div>
                <div class="chart-grid">
                    <div class="chart-container"><h2>Ra√ßas</h2><canvas id="racaChart"></canvas></div>
                    <div class="chart-container"><h2>Sexo</h2><canvas id="sexoChart"></canvas></div>
                    <div class="chart-container"><h2>Locais</h2><canvas id="localChart"></canvas></div>
                    <div class="chart-container"><h2>Propriet√°rios</h2><canvas id="proprietarioChart"></canvas></div>
                </div>
                <div class="chart-container"><h2>Idade</h2><canvas id="idadeChart"></canvas></div>
            </div>

            <div id="tab-genealogy" class="tab-content hidden">
                <div class="card">
                    <h2>üå≥ √Årvore Geneal√≥gica</h2>
                    <div class="form-group">
                        <label>Selecione um Animal</label>
                        <select id="animalGenealogia" onchange="mostrarGenealogia()">
                            <option value="">Escolha um animal...</option>
                        </select>
                    </div>
                    <div id="arvoreGenealogia"></div>
                </div>
            </div>

            <div id="tab-racas" class="tab-content hidden">
                <div class="card" style="max-width: 700px; margin: 0 auto;">
                    <h2>üè∑Ô∏è Ra√ßas</h2>
                    <div class="form-group"><input type="text" id="nomeRaca" placeholder="Nome da ra√ßa"></div>
                    <button class="btn btn-primary" onclick="adicionarRaca()">‚ûï Adicionar</button>
                    <div id="listaRacas" class="item-list"></div>
                </div>
            </div>

            <div id="tab-locais" class="tab-content hidden">
                <div class="card" style="max-width: 700px; margin: 0 auto;">
                    <h2>üìç Locais</h2>
                    <div class="form-group"><input type="text" id="nomeLocal" placeholder="Nome do local"></div>
                    <button class="btn btn-primary" onclick="adicionarLocal()">‚ûï Adicionar</button>
                    <div id="listaLocais" class="item-list"></div>
                </div>
            </div>

            <div id="tab-tools" class="tab-content hidden">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem;">
                    <div class="card">
                        <h2>‚öñÔ∏è Arrobas</h2>
                        <div class="form-group"><label>Peso Vivo (KG)</label><input type="number" id="pesoVivo" step="0.01"></div>
                        <div class="form-group"><label>Peso Morto (KG)</label><input type="number" id="pesoMorto" step="0.01"></div>
                        <button class="btn btn-primary" onclick="calcularArrobas()">Calcular</button>
                        <p id="resultadoArrobas" style="margin-top: 1.5rem; font-weight: bold; color: #667eea;"></p>
                    </div>
                    <div class="card">
                        <h2>ü§∞ Parto</h2>
                        <div class="form-group"><label>Data Insemina√ß√£o</label><input type="date" id="dataInseminacao"></div>
                        <button class="btn btn-primary" onclick="calcularParto()">Calcular</button>
                        <p id="resultadoParto" style="margin-top: 1.5rem; font-weight: bold; color: #667eea;"></p>
                    </div>
                    <div class="card">
                        <h2>üìÖ Idade</h2>
                        <div class="form-group"><label>Data Nascimento</label><input type="date" id="dataNascIdade"></div>
                        <button class="btn btn-primary" onclick="calcularIdade()">Calcular</button>
                        <p id="resultadoIdade" style="margin-top: 1.5rem; font-weight: bold; color: #667eea;"></p>
                    </div>
                </div>
            </div>

            <div id="tab-owners" class="tab-content hidden">
                <div class="card" style="max-width: 700px; margin: 0 auto;">
                    <h2>üë• Propriet√°rios</h2>
                    <div class="form-group"><input type="text" id="nomeProprietario" placeholder="Nome do propriet√°rio"></div>
                    <button class="btn btn-primary" onclick="adicionarProprietario()">‚ûï Adicionar</button>
                    <div id="listaProprietarios" class="item-list"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="firebaseModal" class="modal">
        <div class="modal-content">
            <h2>üî• Configurar Firebase</h2>
            <div class="form-group"><label>API Key</label><input type="text" id="firebaseApiKey"></div>
            <div class="form-group"><label>Auth Domain</label><input type="text" id="firebaseAuthDomain"></div>
            <div class="form-group"><label>Database URL</label><input type="text" id="firebaseDatabaseURL"></div>
            <div class="form-group"><label>Project ID</label><input type="text" id="firebaseProjectId"></div>
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-secondary" onclick="fecharModalFirebase()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarConfigFirebase()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <script>
        let animais = [];
        let proprietarios = [];
        let racas = ['NELORE','ANGUS','BRAHMAN','TABAPU√É','SENEPOL','GIROLANDO','HOLANDESA','GIR','JERSEY'];
        let locais = ['PASTO 1','PASTO 2','CURRAL'];
        let animalAtualId = null;
        let charts = {};
        let database = null;

        window.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            tentarConectarFirebase();
        });

        async function carregarDados() {
            try {
                const storageAnimais = await window.storage.get('animais').catch(() => null);
                const storageProp = await window.storage.get('proprietarios').catch(() => null);
                const storageRacas = await window.storage.get('racas').catch(() => null);
                const storageLocais = await window.storage.get('locais').catch(() => null);

                animais = storageAnimais ? JSON.parse(storageAnimais.value) : [];
                proprietarios = storageProp ? JSON.parse(storageProp.value) : [];
                racas = storageRacas ? JSON.parse(storageRacas.value) : ['NELORE','ANGUS','BRAHMAN','TABAPU√É','SENEPOL','GIROLANDO','HOLANDESA','GIR','JERSEY'];
                locais = storageLocais ? JSON.parse(storageLocais.value) : ['PASTO 1','PASTO 2','CURRAL'];
            } catch (error) {
                console.log('Erro ao carregar do storage', error);
            }

            renderizarTabela();
            atualizarSelects();
            atualizarListaProprietarios();
            atualizarListaRacas();
            atualizarListaLocais();
            atualizarSelectGenealogia();
        }

        async function salvarDados() {
            try {
                await window.storage.set('animais', JSON.stringify(animais));
                await window.storage.set('proprietarios', JSON.stringify(proprietarios));
                await window.storage.set('racas', JSON.stringify(racas));
                await window.storage.set('locais', JSON.stringify(locais));
            } catch (error) {
                console.log('Erro ao salvar', error);
            }

            if (database) {
                try {
                    await database.ref('animais').set(animais);
                    await database.ref('proprietarios').set(proprietarios);
                    await database.ref('racas').set(racas);
                    await database.ref('locais').set(locais);
                    document.getElementById('syncStatus').textContent = 'Sincronizado ‚úì';
                } catch (error) {
                    console.log('Erro Firebase sync', error);
                }
            }
        }

        async function tentarConectarFirebase() {
            try {
                const configData = await window.storage.get('firebaseConfig').catch(() => null);
                if (configData) {
                    const config = JSON.parse(configData.value);
                    if (!firebase.apps.length) {
                        firebase.initializeApp(config);
                        database = firebase.database();
                        document.getElementById('syncStatus').textContent = 'Firebase conectado ‚úì';
                    }
                }
            } catch (error) {
                console.log('Firebase n√£o configurado', error);
            }
        }

        function toggleBrinco() {
            const usaBrinco = document.getElementById('usaBrinco').checked;
            const campoBrinco = document.getElementById('campoBrinco');
            if (usaBrinco) {
                campoBrinco.classList.remove('hidden');
            } else {
                campoBrinco.classList.add('hidden');
                document.getElementById('brinco').value = '';
            }
        }

        function gerarNumero() {
            const numero = Math.floor(Math.random() * 900000) + 100000;
            document.getElementById('numero').value = numero;
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.add('hidden'));
            
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            event.target.classList.add('active');
            
            if (tabName === 'reports') {
                atualizarRelatorios();
            }
        }

        function salvarAnimal(event) {
            event.preventDefault();
            
            const animal = {
                id: animalAtualId || Date.now().toString(),
                numero: document.getElementById('numero').value,
                brinco: document.getElementById('brinco').value,
                nome: document.getElementById('nome').value,
                sexo: document.getElementById('sexo').value,
                raca: document.getElementById('raca').value,
                local: document.getElementById('local').value,
                proprietario: document.getElementById('proprietario').value,
                dataNascimento: document.getElementById('dataNascimento').value,
                pai: document.getElementById('pai').value,
                mae: document.getElementById('mae').value,
                semFerro: document.getElementById('semFerro').checked,
                amamentando: document.getElementById('amamentando').checked,
                observacoes: document.getElementById('observacoes').value
            };

            if (animalAtualId) {
                const index = animais.findIndex(a => a.id === animalAtualId);
                if (index !== -1) animais[index] = animal;
            } else {
                animais.push(animal);
            }

            salvarDados();
            renderizarTabela();
            limparForm();
            alert('‚úÖ Animal salvo com sucesso!');
        }

        function limparForm() {
            document.getElementById('animalForm').reset();
            animalAtualId = null;
            document.getElementById('campoBrinco').classList.add('hidden');
            document.querySelectorAll('tbody tr').forEach(tr => tr.classList.remove('selected'));
        }

        function excluirAnimal() {
            if (!animalAtualId) {
                alert('‚ö†Ô∏è Selecione um animal primeiro!');
                return;
            }
            
            if (confirm('Tem certeza que deseja excluir este animal?')) {
                animais = animais.filter(a => a.id !== animalAtualId);
                salvarDados();
                renderizarTabela();
                limparForm();
                alert('‚úÖ Animal exclu√≠do!');
            }
        }

        function selecionarAnimal(id) {
            const animal = animais.find(a => a.id === id);
            if (!animal) return;

            animalAtualId = id;
            document.getElementById('numero').value = animal.numero || '';
            document.getElementById('brinco').value = animal.brinco || '';
            document.getElementById('nome').value = animal.nome || '';
            document.getElementById('sexo').value = animal.sexo || 'M';
            document.getElementById('raca').value = animal.raca || '';
            document.getElementById('local').value = animal.local || '';
            document.getElementById('proprietario').value = animal.proprietario || '';
            document.getElementById('dataNascimento').value = animal.dataNascimento || '';
            document.getElementById('pai').value = animal.pai || '';
            document.getElementById('mae').value = animal.mae || '';
            document.getElementById('semFerro').checked = animal.semFerro || false;
            document.getElementById('amamentando').checked = animal.amamentando || false;
            document.getElementById('observacoes').value = animal.observacoes || '';
            
            if (animal.brinco) {
                document.getElementById('usaBrinco').checked = true;
                document.getElementById('campoBrinco').classList.remove('hidden');
            }

            document.querySelectorAll('tbody tr').forEach(tr => tr.classList.remove('selected'));
            document.querySelector(`tr[data-id="${id}"]`)?.classList.add('selected');
        }

        function renderizarTabela() {
            const tbody = document.getElementById('tabelaAnimais');
            
            if (animais.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Nenhum animal cadastrado</td></tr>';
                return;
            }

            tbody.innerHTML = animais.map(animal => `
                <tr data-id="${animal.id}" onclick="selecionarAnimal('${animal.id}')">
                    <td>${animal.numero || '-'}</td>
                    <td>${animal.brinco || '-'}</td>
                    <td>${animal.nome || '-'}</td>
                    <td>${animal.sexo === 'M' ? 'Macho' : 'F√™mea'}</td>
                    <td>${animal.raca || '-'}</td>
                    <td>${animal.local || '-'}</td>
                </tr>
            `).join('');
        }

        function pesquisarAnimais(termo) {
            const tbody = document.getElementById('tabelaAnimais');
            const termoLower = termo.toLowerCase();
            
            const filtrados = animais.filter(animal => 
                (animal.numero || '').toLowerCase().includes(termoLower) ||
                (animal.brinco || '').toLowerCase().includes(termoLower) ||
                (animal.nome || '').toLowerCase().includes(termoLower) ||
                (animal.raca || '').toLowerCase().includes(termoLower) ||
                (animal.local || '').toLowerCase().includes(termoLower)
            );

            if (filtrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Nenhum resultado encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = filtrados.map(animal => `
                <tr data-id="${animal.id}" onclick="selecionarAnimal('${animal.id}')">
                    <td>${animal.numero || '-'}</td>
                    <td>${animal.brinco || '-'}</td>
                    <td>${animal.nome || '-'}</td>
                    <td>${animal.sexo === 'M' ? 'Macho' : 'F√™mea'}</td>
                    <td>${animal.raca || '-'}</td>
                    <td>${animal.local || '-'}</td>
                </tr>
            `).join('');
        }

        function atualizarSelects() {
            const selectRaca = document.getElementById('raca');
            const selectLocal = document.getElementById('local');
            const selectProprietario = document.getElementById('proprietario');
            const selectPai = document.getElementById('pai');
            const selectMae = document.getElementById('mae');

            selectRaca.innerHTML = '<option value="">Selecione...</option>' + 
                racas.map(r => `<option value="${r}">${r}</option>`).join('');
            
            selectLocal.innerHTML = '<option value="">Selecione...</option>' + 
                locais.map(l => `<option value="${l}">${l}</option>`).join('');
            
            selectProprietario.innerHTML = '<option value="">Selecione...</option>' + 
                proprietarios.map(p => `<option value="${p}">${p}</option>`).join('');

            const machos = animais.filter(a => a.sexo === 'M');
            const femeas = animais.filter(a => a.sexo === 'F');

            selectPai.innerHTML = '<option value="">Selecione...</option>' + 
                machos.map(m => `<option value="${m.id}">${m.numero} - ${m.nome || 'Sem nome'}</option>`).join('');
            
            selectMae.innerHTML = '<option value="">Selecione...</option>' + 
                femeas.map(f => `<option value="${f.id}">${f.numero} - ${f.nome || 'Sem nome'}</option>`).join('');
        }

        function adicionarProprietario() {
            const nome = document.getElementById('nomeProprietario').value.trim();
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome!');
                return;
            }
            if (proprietarios.includes(nome)) {
                alert('‚ö†Ô∏è Propriet√°rio j√° existe!');
                return;
            }
            proprietarios.push(nome);
            salvarDados();
            atualizarListaProprietarios();
            atualizarSelects();
            document.getElementById('nomeProprietario').value = '';
        }

        function atualizarListaProprietarios() {
            const lista = document.getElementById('listaProprietarios');
            lista.innerHTML = proprietarios.map(p => `
                <div class="item-box">
                    <span>${p}</span>
                    <button class="btn btn-danger" onclick="removerProprietario('${p}')">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function removerProprietario(nome) {
            if (confirm('Tem certeza?')) {
                proprietarios = proprietarios.filter(p => p !== nome);
                salvarDados();
                atualizarListaProprietarios();
                atualizarSelects();
            }
        }

        function adicionarRaca() {
            const nome = document.getElementById('nomeRaca').value.trim().toUpperCase();
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome!');
                return;
            }
            if (racas.includes(nome)) {
                alert('‚ö†Ô∏è Ra√ßa j√° existe!');
                return;
            }
            racas.push(nome);
            salvarDados();
            atualizarListaRacas();
            atualizarSelects();
            document.getElementById('nomeRaca').value = '';
        }

        function atualizarListaRacas() {
            const lista = document.getElementById('listaRacas');
            lista.innerHTML = racas.map(r => `
                <div class="item-box">
                    <span>${r}</span>
                    <button class="btn btn-danger" onclick="removerRaca('${r}')">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function removerRaca(nome) {
            if (confirm('Tem certeza?')) {
                racas = racas.filter(r => r !== nome);
                salvarDados();
                atualizarListaRacas();
                atualizarSelects();
            }
        }

        function adicionarLocal() {
            const nome = document.getElementById('nomeLocal').value.trim().toUpperCase();
            if (!nome) {
                alert('‚ö†Ô∏è Digite um nome!');
                return;
            }
            if (locais.includes(nome)) {
                alert('‚ö†Ô∏è Local j√° existe!');
                return;
            }
            locais.push(nome);
            salvarDados();
            atualizarListaLocais();
            atualizarSelects();
            document.getElementById('nomeLocal').value = '';
        }

        function atualizarListaLocais() {
            const lista = document.getElementById('listaLocais');
            lista.innerHTML = locais.map(l => `
                <div class="item-box">
                    <span>${l}</span>
                    <button class="btn btn-danger" onclick="removerLocal('${l}')">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function removerLocal(nome) {
            if (confirm('Tem certeza?')) {
                locais = locais.filter(l => l !== nome);
                salvarDados();
                atualizarListaLocais();
                atualizarSelects();
            }
        }

        function atualizarSelectGenealogia() {
            const select = document.getElementById('animalGenealogia');
            select.innerHTML = '<option value="">Escolha um animal...</option>' +
                animais.map(a => `<option value="${a.id}">${a.numero} - ${a.nome || 'Sem nome'}</option>`).join('');
        }

        function mostrarGenealogia() {
            const id = document.getElementById('animalGenealogia').value;
            if (!id) {
                document.getElementById('arvoreGenealogia').innerHTML = '';
                return;
            }

            const animal = animais.find(a => a.id === id);
            if (!animal) return;

            const pai = animais.find(a => a.id === animal.pai);
            const mae = animais.find(a => a.id === animal.mae);

            let html = `<div class="genealogy-tree">
                <div class="tree-node"><strong>üêÆ ${animal.numero} - ${animal.nome || 'Sem nome'}</strong><br>
                ${animal.sexo === 'M' ? 'Macho' : 'F√™mea'} | ${animal.raca || 'Sem ra√ßa'}</div>`;

            if (pai || mae) {
                html += '<div class="tree-branch">';
                if (pai) {
                    html += `<div class="tree-node">üë® Pai: ${pai.numero} - ${pai.nome || 'Sem nome'}<br>${pai.raca || 'Sem ra√ßa'}</div>`;
                }
                if (mae) {
                    html += `<div class="tree-node">üë© M√£e: ${mae.numero} - ${mae.nome || 'Sem nome'}<br>${mae.raca || 'Sem ra√ßa'}</div>`;
                }
                html += '</div>';
            }

            html += '</div>';
            document.getElementById('arvoreGenealogia').innerHTML = html;
        }

        function calcularArrobas() {
            const pesoVivo = parseFloat(document.getElementById('pesoVivo').value);
            const pesoMorto = parseFloat(document.getElementById('pesoMorto').value);
            
            if (pesoVivo > 0) {
                const arrobas = pesoVivo / 15;
                document.getElementById('resultadoArrobas').textContent = 
                    `Peso Vivo: ${arrobas.toFixed(2)} arrobas`;
            } else if (pesoMorto > 0) {
                const arrobas = pesoMorto / 15;
                document.getElementById('resultadoArrobas').textContent = 
                    `Peso Morto: ${arrobas.toFixed(2)} arrobas`;
            } else {
                alert('‚ö†Ô∏è Preencha pelo menos um peso!');
            }
        }

        function calcularParto() {
            const data = document.getElementById('dataInseminacao').value;
            if (!data) {
                alert('‚ö†Ô∏è Selecione uma data!');
                return;
            }
            
            const dataInsemin = new Date(data);
            dataInsemin.setDate(dataInsemin.getDate() + 283);
            
            const dia = String(dataInsemin.getDate()).padStart(2, '0');
            const mes = String(dataInsemin.getMonth() + 1).padStart(2, '0');
            const ano = dataInsemin.getFullYear();
            
            document.getElementById('resultadoParto').textContent = 
                `Data prevista do parto: ${dia}/${mes}/${ano}`;
        }

        function calcularIdade() {
            const data = document.getElementById('dataNascIdade').value;
            if (!data) {
                alert('‚ö†Ô∏è Selecione uma data!');
                return;
            }
            
            const nascimento = new Date(data);
            const hoje = new Date();
            
            let anos = hoje.getFullYear() - nascimento.getFullYear();
            let meses = hoje.getMonth() - nascimento.getMonth();
            
            if (meses < 0) {
                anos--;
                meses += 12;
            }
            
            document.getElementById('resultadoIdade').textContent = 
                `Idade: ${anos} anos e ${meses} meses`;
        }

        function atualizarRelatorios() {
            const total = animais.length;
            const femeas = animais.filter(a => a.sexo === 'F').length;
            const machos = animais.filter(a => a.sexo === 'M').length;
            const amamentando = animais.filter(a => a.amamentando).length;
            const semFerro = animais.filter(a => a.semFerro).length;
            const totalRacas = [...new Set(animais.map(a => a.raca).filter(r => r))].length;

            document.getElementById('totalAnimais').textContent = total;
            document.getElementById('totalFemeas').textContent = femeas;
            document.getElementById('totalMachos').textContent = machos;
            document.getElementById('totalAmamentando').textContent = amamentando;
            document.getElementById('totalSemFerro').textContent = semFerro;
            document.getElementById('totalRacas').textContent = totalRacas;

            criarGraficos();
        }

        function criarGraficos() {
            const racasCount = {};
            const locaisCount = {};
            const proprietariosCount = {};

            animais.forEach(a => {
                if (a.raca) racasCount[a.raca] = (racasCount[a.raca] || 0) + 1;
                if (a.local) locaisCount[a.local] = (locaisCount[a.local] || 0) + 1;
                if (a.proprietario) proprietariosCount[a.proprietario] = (proprietariosCount[a.proprietario] || 0) + 1;
            });

            if (charts.raca) charts.raca.destroy();
            charts.raca = new Chart(document.getElementById('racaChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(racasCount),
                    datasets: [{
                        data: Object.values(racasCount),
                        backgroundColor: ['#3b82f6', '#22c55e', '#ef4444', '#a855f7', '#f59e0b', '#ec4899', '#06b6d4', '#8b5cf6']
                    }]
                }
            });

            if (charts.sexo) charts.sexo.destroy();
            charts.sexo = new Chart(document.getElementById('sexoChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Machos', 'F√™meas'],
                    datasets: [{
                        data: [animais.filter(a => a.sexo === 'M').length, animais.filter(a => a.sexo === 'F').length],
                        backgroundColor: ['#3b82f6', '#ec4899']
                    }]
                }
            });

            if (charts.local) charts.local.destroy();
            charts.local = new Chart(document.getElementById('localChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(locaisCount),
                    datasets: [{
                        label: 'Animais por Local',
                        data: Object.values(locaisCount),
                        backgroundColor: '#22c55e'
                    }]
                }
            });

            if (charts.proprietario) charts.proprietario.destroy();
            charts.proprietario = new Chart(document.getElementById('proprietarioChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(proprietariosCount),
                    datasets: [{
                        label: 'Animais por Propriet√°rio',
                        data: Object.values(proprietariosCount),
                        backgroundColor: '#a855f7'
                    }]
                }
            });

            const idades = {};
            animais.forEach(a => {
                if (a.dataNascimento) {
                    const nasc = new Date(a.dataNascimento);
                    const anos = new Date().getFullYear() - nasc.getFullYear();
                    idades[anos] = (idades[anos] || 0) + 1;
                }
            });

            if (charts.idade) charts.idade.destroy();
            charts.idade = new Chart(document.getElementById('idadeChart'), {
                type: 'line',
                data: {
                    labels: Object.keys(idades).sort((a, b) => a - b),
                    datasets: [{
                        label: 'Distribui√ß√£o por Idade',
                        data: Object.keys(idades).sort((a, b) => a - b).map(k => idades[k]),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true
                    }]
                }
            });
        }

        function exportarExcel() {
            const dados = animais.map(a => ({
                'N√öMERO': a.numero,
                'Brinco': a.brinco,
                'Nome': a.nome,
                'Sexo': a.sexo === 'M' ? 'Macho' : 'F√™mea',
                'Ra√ßa': a.raca,
                'Local': a.local,
                'Propriet√°rio': a.proprietario,
                'Nascimento': a.dataNascimento,
                'Pai': animais.find(p => p.id === a.pai)?.numero || '',
                'M√£e': animais.find(m => m.id === a.mae)?.numero || '',
                'Sem Ferro': a.semFerro ? 'Sim' : 'N√£o',
                'Amamentando': a.amamentando ? 'Sim' : 'N√£o',
                'Observa√ß√µes': a.observacoes
            }));

            const ws = XLSX.utils.json_to_sheet(dados);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Animais');
            XLSX.writeFile(wb, 'animais.xlsx');
        }

        function exportarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('Lista de Animais', 20, 20);
            
            let y = 40;
            animais.forEach((a, i) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFontSize(10);
                doc.text(`${i + 1}. ${a.numero} - ${a.nome || 'Sem nome'} | ${a.sexo === 'M' ? 'Macho' : 'F√™mea'} | ${a.raca || '-'}`, 20, y);
                y += 10;
            });
            
            doc.save('animais.pdf');
        }

        async function sincronizar() {
            await salvarDados();
            await carregarDados();
            alert('‚úÖ Sincronizado!');
        }

        function abrirModalFirebase() {
            document.getElementById('firebaseModal').classList.add('active');
        }

        function fecharModalFirebase() {
            document.getElementById('firebaseModal').classList.remove('active');
        }

        async function salvarConfigFirebase() {
            const config = {
                apiKey: document.getElementById('firebaseApiKey').value,
                authDomain: document.getElementById('firebaseAuthDomain').value,
                databaseURL: document.getElementById('firebaseDatabaseURL').value,
                projectId: document.getElementById('firebaseProjectId').value
            };

            if (!config.apiKey || !config.databaseURL) {
                alert('Preencha pelo menos API Key e Database URL');
                return;
            }

            try {
                await window.storage.set('firebaseConfig', JSON.stringify(config));
                firebase.initializeApp(config);
                database = firebase.database();
                fecharModalFirebase();
                alert('‚úÖ Firebase configurado!');
                document.getElementById('syncStatus').textContent = 'Firebase OK ‚úì';
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            }
        }
    </script>
<script type="module">

  // Import the functions you need from the SDKs you need

  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";

  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";

  // TODO: Add SDKs for Firebase products that you want to use

  // https://firebase.google.com/docs/web/setup#available-libraries


  // Your web app's Firebase configuration

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional

  const firebaseConfig = {

    apiKey: "AIzaSyC7SscZZ2uhic2JXaQYfmnvh5mRgwpk0y8",

    authDomain: "gado-5821a.firebaseapp.com",

    projectId: "gado-5821a",

    storageBucket: "gado-5821a.firebasestorage.app",

    messagingSenderId: "1065455551718",

    appId: "1:1065455551718:web:9e20cc6e84dc76e0ae6727",

    measurementId: "G-Q98K1CMBK3"

  };


  // Initialize Firebase

  const app = initializeApp(firebaseConfig);

  const analytics = getAnalytics(app);

</script>
</body>
</html>
